<% provide(:title, "Edit Project Proposal") %>

<section id="new-repo">
  <div class="title"><%=t('project_proposal.edit') %></div>
  <%= link_to fa_icon("search", text: t('project_proposal.view')), project_proposal_path(@project_proposal.slug), class: 'edit-repo-link', id: 'view-repo-link' %>
  <%= form_for @project_proposal, url: {controller: "project_proposals", action: "update"}, html: {multipart: true, class: "edit_project_proposal needs-validation", novalidate: true} do |f| %>
    
    <div class="mb-3 required">
      <%= f.label :username, t('project_proposal.name'), class: "form-label" %>
      <div><%=t('project_proposal.name_short_text') %> </div>
      <%= f.text_field :username, class: 'form-control', autofocus: true, required: true %>
    </div>
    
    <div class="mb-3 required">
      <%= f.label :email, t('project_proposal.email'), class: "form-label" %>
      <div><%=t('project_proposal.email_short_text') %></div>
      <%= f.text_field :email, class: 'form-control', autofocus: true, required: true %>
    </div>
    
    <div class="mb-3 required">
      <%= f.label :title, t('project_proposal.title'), class: "form-label" %>
      <div><%=t('project_proposal.title_short_text') %></div>
      <%= f.text_field :title, class: 'form-control', required: true %>
      
    </div>
    
    <div class="mb-3 required">
      <%= f.label :client_type, t('project_proposal.client_type'), class: "form-label" %>
      <div><%=t('project_proposal.client_type_short_text') %></div>
      <div class='checkbox-list form-check'>
        <%= f.radio_button :client_type, t('project_proposal.client_type_organization'), :checked => true, :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'client_type_organization', t('project_proposal.client_type_organization'), :id => 'type', :style => 'display:inline', class: "form-check-label" %>
        <br>
        <%= f.radio_button :client_type, t('project_proposal.client_type_individual'), :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'client_type_individual', t('project_proposal.client_type_individual'), :id => 'type', :style => 'display:inline', class: "form-check-label" %>
      </div>
    </div>
    
    <div class="mb-3 required">
      <%= f.label :client, "Client", class: "form-label" %>
      <div><%=t('project_proposal.client_short_text') %></div>
      <%= f.text_field :client, class: 'form-control' %>
    </div>
    
    <div class="mb-3 required">
      <%= f.label :client_interest, t('project_proposal.client_interest_level'), class: "form-label" %>
      <div><%=t('project_proposal.client_interest_level_short_text') %></div>
      <div class='checkbox-list form-check'>
        <%= f.radio_button :client_interest, t('project_proposal.client_interest_level_low'), :checked => true, :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'client_interest_low', t('project_proposal.client_interest_level_low'), :id => 'type', :style => 'display:inline', class:"form-check-label" %>
        <br>
        <%= f.radio_button :client_interest, t('project_proposal.client_interest_level_medium'), :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'client_interest_medium', t('project_proposal.client_interest_level_medium'), :id => 'type', :style => 'display:inline', class:"form-check-label" %>
        <br>
        <%= f.radio_button :client_interest, t('project_proposal.client_interest_level_high'), :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'client_interest_high', t('project_proposal.client_interest_level_high'), :id => 'type', :style => 'display:inline', class:"form-check-label" %>
      </div>
    </div>
    <br/>
    <div class="mb-3 required">
      <%= f.label :client_background, t('project_proposal.client_background'), class: "form-label" %>
      <div><%=t('project_proposal.client_background_short_text') %></div>
      <div style="width: 420px;">
        <%= f.hidden_field :client_background, id: :project_proposal_client_background, class: "form-control" %>
        <trix-editor input="project_proposal_client_background"></trix-editor>
        <div class="invalid-feedback">
          Veuillez entrer le contexte du client / Please enter client's background
        </div>
      </div>
    </div>
    <br/>
    <div class="mb-3">
      <%= f.label :supervisor_background, t('project_proposal.supervisor_background'), class: "form-label" %>
      <div><%=t('project_proposal.supervisor_background_short_text') %></div>
      <%= f.hidden_field :supervisor_background, id: :project_proposal_supervisor_background, class: "form-control" %>
      <trix-editor input="project_proposal_supervisor_background"></trix-editor>
    </div>
    
    <div class="mb-3 required">
      <%= f.label :description, t('project_proposal.project_background'), class: "form-label" %>
      <div>Donnez une description a la propositionGive a description to the proposal</div>
      <div style="width: 420px;">
        <%= f.hidden_field :description, id: :project_proposal_description, class: "form-control", required: true %>
        <trix-editor input="project_proposal_description" style="min-height: 100px;"></trix-editor>
        <div class="invalid-feedback">
          <%= t('project_proposal.background_feedback') %>
        </div>
      </div>
    </div>

    

    <%= label_tag :file, t('project_proposal.project_files').html_safe, class:"form-label" %>
    <div class="mb-3">
      <div class="input-group mb-3">
        <%= file_field_tag 'files[]', type: :files, multiple: true, class: 'form-control', aria_label: 'Project Files / Fichiers du projet' %>
        <button class="btn btn-success d-inline-block float-end w-auto" type="button" id="new-file-input">
          <i class="fa fa-plus"></i>
        </button>
      </div>
    </div>
    <div id="file-container">

      <% @files.each do |f| %>
        <table>
          <tr class="file-item">
            <td><%= fa_icon "file-text-o" %> <%= f.file.filename %></td>
            <td><span><%= f.file.byte_size/1000 %> KB</span></td>
            <td><span id="<%= f.file.id %>" class="file-remove"><%=t('repo.remove') %></span></td>
          </tr>
        </table>
      <% end %>
      <%= hidden_field_tag 'deletefiles' %>
    </div>
    <br />

    <br />
    <%= label_tag :photo, t('project_proposal.gallery'), class:"form-label required" %>
    <div class="mb-3">
      <div>
        <div class="input-group mb-3">
          <%= file_field_tag 'images[]', type: :files, multiple: true, class: "form-control image-upload", aria_label: "Select Pictures / Selectionner des images" %>
          <button class="btn btn-success d-inline-block float-end w-auto" type="button" id="new-photo-input">
            <i class="fa fa-plus"></i>
          </button>
        </div>
      </div>
      <div class="mx-auto repo-image">
        <div id="dragndrop" ondrop="dragndrop(event);" ondragover="dragover(event);">
          
          <%= fa_icon 'cloud-upload' %>
          <p>Drag &amp; Drop</p>
        </div>
      </div>
    </div>
    <div id="image-container" class="mx-auto">
      <% @photos.each do |img| %>
        <div class="image-item">
          <span id="<%= img.image.filename %>" class="image-remove"></span>
          <%= image_tag img.image, alt: 'Project Proposal Picture' %>
        </div>
      <% end %>
      <%= hidden_field_tag 'deleteimages' %>
    </div>

    
    <div class="mb-3">
      <%= f.label :equipments, t('project_proposal.possible_tech'), class: "form-label" %>
      <%= f.text_area :equipments, class: 'form-control' %>
    </div>
    
    <%= f.label :youtube_link, "Youtube Link", class: "form-label" %>
    <div><%=t('project_proposal.youtube_text') %></div>
    <%= f.text_field :youtube_link, class: 'repo' %>
    
    <div class="mb-3">
      <%= f.label :past_experiences, t('project_proposal.past_experience'), class: "form-label" %>
      <%= f.text_area :past_experiences, class: 'form-control', value: !f.object.past_experiences.nil? ? f.object.past_experiences.split("|")[0] : f.object.past_experiences %>

      <div id="linkRef">
        <button type="button" id="link-list" class="btn btn-primary link-list btn-sm mb-3">Ajouter un lien / Add a link</button>
        <button type="button" id="remove-link-list" class="btn btn-danger text-white btn-sm">Retirer le dernier lien / Remove last link</button>
        
        <ul class="main_ul"></ul>
      </div>
    </div>

    
    <div class="mb-3 required">
      <%= f.label :project_cost, t('project_proposal.expected_cost'), class: "form-label" %>
      <div><%=t('project_proposal.expected_cost') %></div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">$</span>
        <%= f.number_field :project_cost, class: 'form-control', required: true, value: f.object.project_cost.present? ? f.object.project_cost : 0 %>
        <div class="invalid-feedback">
          <%= t('project_proposal.cost_feedback') %>
        </div>
      </div>
    </div>
    
    <div class="mb-3 required">
      <%= f.label :project_type, t('project_proposal.project_type'), class: "form-label" %>
      <div></div>
      <div class='checkbox-list form-check'>
        <%= f.radio_button :project_type, 'General', :checked => true, :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'project_type_general', 'General', :id => 'type', :style => 'display:inline', class:"form-check-label" %>
        <br>
        <%= f.radio_button :project_type, t('project_proposal.project_type_client_specific'), :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'project_type_client_specific', t('project_proposal.project_type_client_specific'), :id => 'type', :style => 'display:inline', class:"form-check-label" %>
        <br>
        <%= f.radio_button :project_type, t('project_proposal.project_type_na'), :class => 'show_extra form-check-input', :style => 'display:inline' %>
        <%= f.label 'project_type_na__so', t('project_proposal.project_type_na'), :id => 'type', :style => 'display:inline', class:"form-check-label" %>
      </div>
    </div>
    <br/>
    <%= f.label :categories, t('project_proposal.category'), class: "form-label" %>
    <div><%=t('project_proposal.category_short_text') %></div>
    <%= f.select :categories, options_from_collection_for_select(@category_options, :name, :name, @categories.map { |category| category.name }), {include_blank: "Select a category...", include_hidden:false},{class: "profile-text form-control form-select",multiple: true} %>
    
    
    
    <%= f.submit t('project_proposal.edit'), class: "btn btn-primary", data: {disable_with: false} %>
    <span id="status-save"></span>
    <% if flash[:alert] %>
      <div id="alert"><%= flash[:alert] %></div>
    <% end %>

    <script type="text/javascript" charset="utf-8">
        let urls = '<%= !f.object.past_experiences.nil? ? f.object.past_experiences.split("|")[1] : "" %>'.split(",");
        if (urls[0] != "") {
            for (let i = 0; i < urls.length; i++) {
                let listItem = document.createElement("li");
                let listDiv = document.createElement("div");
                let listInput = document.createElement("input");
                listDiv.classList.add("mb-3");
                listInput.classList.add("form-control");
                listInput.setAttribute("type", "text");
                listInput.placeholder = "Ajoutez un lien / Add a link"
                listInput.value = urls[i];
                listDiv.appendChild(listInput);
                listItem.appendChild(listDiv);
                document.getElementsByClassName("main_ul")[0].appendChild(listItem);
            }
        }
    </script>
<% end %>
</section>


